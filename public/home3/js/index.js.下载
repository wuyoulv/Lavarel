!function(t,$){PATH_RREFIX=0==_US_TEST?"":"test.";var e={shichang:function(t){return 30*t*t-20*t},swithWidth:function(){return $("body").width()<1312?460:540},swithWidthNew:function(){return $("body").width()<1312?430:540},setMw:function(){return $("body").width()<1312,20},Ajax:{getScript:function(e,a,i){if("string"==typeof arguments[0]){var a="function"==typeof arguments[1]?a:function(){},i="boolean"==typeof arguments[2]&&i,n=document.getElementsByTagName("HEAD")[0],o=document.createElement("SCRIPT");o.type="text/javascript",o.src=e,n.appendChild(o),t.addEventListener?o.onerror=o.onload=function(){a(),i&&o.parentNode.removeChild(this)}:o.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||(a(),i&&this.parentNode.removeChild(this))}}},getData:function(t,e,a){$.ajax({type:"get",dataType:"json",url:t,success:function(t){e(t)},error:function(){a.html("<p style='text-align:center;width:100%'>\u670d\u52a1\u5668\u5f00\u5c0f\u5dee\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5</p>")},cache:!1})}}};$.fn.hoverDelay=function(t){var e,a,i={hoverDuring:200,outDuring:200,hoverEvent:function(){$.noop()},outEvent:function(){$.noop()}},n=$.extend(i,t||{});return $(this).each(function(){$(this).hover(function(){clearTimeout(a),e=setTimeout(n.hoverEvent,n.hoverDuring)},function(){clearTimeout(e),a=setTimeout(n.outEvent,n.outDuring)})})};var a=function(t,e){return this.el=t,this.opts=e,this.arrowLeft=t.find(".arrow-left"),this.arrowRight=t.find(".arrow-right"),this.wrap=this.opts.wrap,this.w1=this.el.width(),this.w2=this.wrap.width(),this.w3=this.opts.w3||this.wrap.find(".con").eq(0).width(),this.mw=this.opts.mw,this.distX=0,this.init(),this};a.prototype={init:function(){var t=this;t.show(t.arrowRight),t.addEvent(),t.update()},update:function(){var a=this,i=$("#task-box li").length;t.onresize=function(){$("#task-box").css("width",e.swithWidthNew()*i+i+"px"),a.w1=a.el.width(),a.w2=a.wrap.width(),a.w3=a.opts.w3||a.wrap.find(".con").eq(0).width(),a.mw=a.opts.mw},$(".content-box").width()>document.documentElement.offsetWidth&&$(".w1080 .head-container").css("width","1080px"),$(t).resize(function(){$(".content-box").width()>document.documentElement.offsetWidth&&$(".w1080 .head-container").css("width","1080px")})},addEvent:function(){var t=this;t.el.on("click","a.arrow-left",function(){t.scrollLeft()}),t.el.on("click","a.arrow-right",function(){t.scrollRight()})},offEvent:function(){var t=this;t.el.off("click","a.arrow-left"),t.el.off("click","a.arrow-right")},switchBox:function(){var t=this;t.distX<0&&t.show(t.arrowLeft),t.wrap.animate({left:t.distX+"px"},500,"swing",null)},scrollLeft:function(){var t=this;Math.abs(t.distX)>t.w1?t.distX=t.distX+t.w1+t.mw:t.distX=0,t.switchBox(),t.show(t.arrowRight),Math.abs(t.distX)<=1&&t.hide(t.arrowLeft)},scrollRight:function(){var t=this,e=t.w2+t.distX-t.w1;e<t.w1?t.distX=t.w1-t.w2+t.mw:t.distX=t.distX-t.w1-t.mw,t.switchBox(),t.show(t.arrowLeft),t.w2-(Math.abs(t.distX)+t.w1+2*t.mw)<=t.mw+1&&t.hide(t.arrowRight)},show:function(t){t.css("display","block")},hide:function(t){t.css("display","none")},destroy:function(){this.wrap.css({left:"0"}),this.hide(this.arrowRight),this.hide(this.arrowLeft),this.offEvent(),this.el=null,this.opts=null,this.w1=0,this.w2=0,this.w3=0,this.mw=0,this.distX=0}};var i=function(){this.TASK_TAB=null,this.appData=appData,this.addEvent(),this.init()};i.prototype={url_config:{PLAY_LOG_URL:"/api/usc/get_playlog",TASK_URL:"http://"+PATH_RREFIX+"task.youku.com/task/task/get_my_task",GRADE_URL:"http://"+PATH_RREFIX+"lv.youku.com/page/grade/user_gift?nums=4",EX_GIFT_URL:"http://"+PATH_RREFIX+"lv.youku.com/api/grdpri/get_game_gift?gift_id=",RECOMMEND_URL:"/api/usc/get_recommend_list?attach_info=",GET_MALL_URL:"/api/usc/get_mall_config_list?pl=web",VIP_EXT_URL:"/api/usc/get_vip_ext_info",PSN_GRADE_URL:"http://"+PATH_RREFIX+"lv.youku.com/page/grade/task",GOODS_DETAIL_URL:"http://"+PATH_RREFIX+"point.youku.com/page/mall/goods_detail?pl=web",CVIP_PAY_URL:"http://cvip.youku.com/zpd_api/get_pay_channels_num"},init:function(){var t=this;$("#his-content").trigger("load:data"),$("#task-tab").find("a").eq(0).trigger("click"),$("#rec-btn").trigger("click"),e.Ajax.getScript(t.url_config.GRADE_URL+"&callback=UCENTER.gradeGiftRender",null,!0),t.getCvipPay(),t.renderContent(),t.vipBoxScroll(),1==t.appData.is_login&&t.initUserInfo()},bowser:function(){var e=navigator.userAgent.toLowerCase(),a={webkit:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e),iku:/iku/.test(e),html5:function(){var e=document.createElement("input"),a=document.createElement("video");return{h264:!(!a.canPlayType||!a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,"")),history:!!(t.history&&t.history.pushState&&t.history.popState),placeholder:"placeholder"in e}},lang:(navigator.language||navigator.systemLanguage).toLowerCase(),iOS:(e.match(/(ipad|iphone|ipod)/)||[])[0],iOSVersion:(e.match(/os\s+([\d_]+)\s+like\s+mac\s+os/)||[0,"0_0_0"])[1].split("_"),wphone:parseFloat((e.match(/windows\sphone\s(?:os\s)?([\d.]+)/)||["","0"])[1]),android:parseFloat((e.match(/android[\s|\/]([\d.]+)/)||["","0"])[1])};return a.isMobile=!(!a.iOS&&!a.wphone&&!a.android&&void 0===t.orientation),a.isPad=a.isMobile&&("ipad"==a.iOS||e.indexOf("mobile")==-1||e.indexOf("windows nt")!=-1&&e.indexOf("touch")!=-1)||!1,a.isPhone=a.isMobile&&("iphone"==a.iOS||"ipod"==a.iOS)||e.indexOf("mobile")!=-1&&!!a.android||!1,a},addEvent:function(){var a=this,i=navigator.userAgent.toLowerCase();a.bowser();if(i.indexOf("ipad")>-1&&i.indexOf("youku")==-1){$("body").attr("id","f6-ipad"),$("#head-banner,#head-banner-container").show(),$("#head-banner a,.a-more-ipad").unbind("click").bind("click",function(){var a=+new Date,n={record:"youkuhd://webmy?page=record",recommend:"youkuhd://webmy?page=recommend",vipvideo:"youkuhd://webvip?page=home",todayhot:"youkuhd://webhome?page=home"},o={pid:"87c959fb273378eb",guid:"",idfa:"",ouid:"",source:"mplaypage11",ua:i,ver:"",datetime:Math.floor(+new Date/1e3),pagetype:2,refer:"mplaypage11",cookieid:"",tuid:0,special:0,sender:1},r="";for(var l in o)r+="&"+l+"="+o[l];e.Ajax.getScript("http://statis.api.3g.youku.com/openapi-wireless/statis/recall_app_service"+r.replace("&","?")),n=n[$(this).attr("data-role")]||"youkuhd://",t.location=n;var s;if(i.indexOf("like mac os x")>0){var c=/os [\d._]*/gi,d=i.match(c);s=(d+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")}return s<9&&setTimeout(function(){+new Date-a<1e3?t.location="https://itunes.apple.com/cn/app/id394075284":t.close()},50),!1}),$("body").addClass("w1080-ipad");var n=null;$(t).scroll(function(){var t=document.documentElement.scrollTop||document.body.scrollTop;0==t?($("#head-banner-container").fadeIn(),clearTimeout(n),n=null):null==n&&(n=setTimeout(function(){$("#head-banner-container").fadeOut()},5e3))})}else $("body").removeClass("w1080-ipad");$("#his-content").on("load:data",function(){a.playRender($(this))}),$("#task-tab").on("click","a[class='task-tab-a']",function(){a.taskClickHandler($(this))}),$("#grade-wrap").on("click","a[class='exchange']",function(){a.exchangeGift($(this))});var o=$("#grade-btn");o&&o.length>0&&(o.hoverDelay({hoverEvent:a.gradeShowHandler,outEvent:a.gradeHideHandler}),o.on("click",function(e){var i=$(e.target||e.srcElement);"grade-btn"!=i.attr("id")&&"info-desc-packing"!=i.attr("class")||t.open(a.url_config.PSN_GRADE_URL)})),$("#info-box").on("click",function(t){a.loginFn()}),$(".login-a").on("click",function(t){t.preventDefault(),a.loginFn()}),$(document).bind("header:login",function(){t.location.reload()}),$("#rec-btn,.a-more-ipad i").on("click",function(){a.recFn($(this))}),$("#grade-box").on("click","li.dot-p",function(){a.gradeGiftScroll($(this))});var r=$("#vip-btn");r&&r.length>0&&r.hoverDelay({hoverEvent:a.vipShowHandler,outEvent:a.vipHideHandler}),$("#rec-box").on("click","a",a.changeLocation)},initUserInfo:function(){var t=this,a=$("#greet"),i=new Date,n=i.getHours(),o=i.getMinutes(),r=i.getSeconds();$("#head-img");n>5&&(n<8||8==n&&o<=0&&r<=0)?a.text("\u65e9\u4e0a\u597d"):n>=8&&(n<11||11==n&&o<=0&&r<=0)?a.text("\u4e0a\u5348\u597d"):n>=11&&(n<14||14==n&&o<=0&&r<=0)?a.text("\u4e2d\u5348\u597d"):n>=14&&(n<18||18==n&&o<=0&&r<=0)?a.text("\u4e0b\u5348\u597d"):n>=18&&(n<22||22==n&&o<=0&&r<=0)?a.text("\u665a\u4e0a\u597d"):a.text("\u591c\u6df1\u4e86");var l=($("#grade-btn"),$("#today-score")),s=$("#grade-score"),c=$("#upgrade-score"),d=260,h=$("#up-grade-level"),p=$("#grade-level"),u=parseInt(t.appData.grade)>=100?99:parseInt(t.appData.grade),f=u+1;p.text(u),h.text(f),s.text((e.shichang(u)/60).toFixed(1)+"\u5c0f\u65f6"),c.text((e.shichang(f)/60).toFixed(1)+"\u5c0f\u65f6");var g=((e.shichang(f)/60).toFixed(1),Math.ceil((parseInt(t.appData.score)-e.shichang(u))/(e.shichang(f)-e.shichang(u))*d));(t.appData.score/60).toFixed(1)==(e.shichang(u+1)/60).toFixed(1)&&(g=260),l.css({width:g+"px"});var w=t.appData.score-e.shichang(u)<=0?"":t.appData.score-e.shichang(u)<4?"0.1":((t.appData.score/60).toFixed(1)-(e.shichang(u)/60).toFixed(1)).toFixed(1);l.text(w+"\u5c0f\u65f6")},vipShowHandler:function(){var t=$("#vip-info-desc-box"),a=$("#vip-btn"),i=a.offset().left,n=a.offset().top;console.log(n),t.css({left:i+"px",top:n+35+"px","margin-left":"-150px"}).css("display","block");var o=function(e){if(0==e.errno){var a=e.data,i=new Object,n=new Object,o=new Object,r=$("#vip-priv-tpl").html(),l=new Array;n.img_url="ad",o.img_url="gyq",n.data_href=a.noad_url,o.data_href=a.ticket_url,o.content=a.ticket_num,n.content=a.noad_times,n.tip="",o.tip="\u89c2\u5f71\u5238\u5f71\u7247>",l.push(n),l.push(o),i.list=l;var s=template.compile(r,i);t.append(s)}},r=t.find("ul");(!r||r.length<=0)&&e.Ajax.getData(UCENTER.url_config.VIP_EXT_URL,o)},vipHideHandler:function(){var t=$("#vip-info-desc-box");t.hide()},gradeGiftScroll:function(t){t.addClass("cur").siblings().removeClass("cur");var e=t.index();0==e?$("#grade-wrap").animate({left:"0"},500,"linear",null):$("#grade-wrap").animate({left:"-202px"},500,"linear",null)},closeLoad:function(t){var e=$(t.target||t.srcElement),a=e.text();a.indexOf("\u5173\u95ed")>-1&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var i=$("#load-box");i.remove()},recFn:function(t){var a=$("#loading-tpl").html(),i=$("#rec-box");i.html(a);var n=this,o=function(e){var a=e.errno;switch(a){case 0:var n=e.data.fav;if(n&&n.length>0){var o=new Object,r=$("#rec-tpl").html();o.list=n;var l=template.compile(r,o);i.html(l),t.attr("attach_info",e.data.attach_info)}break;default:var s=$("#no-data-tpl").html();i.html(s)}};e.Ajax.getData(n.url_config.RECOMMEND_URL+t.attr("attach_info"),o,i)},renderContent:function(){var t=$("#vip-ul"),e=$("#vip-tpl").html(),a=$("#hot-ul"),i=$("#hot-tpl").html();t.html(e),a.html(i)},changeLocation:function(){var a=$(this),i=a.attr("data-url"),n=a.attr("data-log-url");e.Ajax.getScript(n,null,!0),t.open(i)},loginFn:function(){0==this.appData.is_login&&$("#qheader_login").trigger("click")},gradeShowHandler:function(){var t=$("#view-grade-box");t.css({left:"50%",top:"36px","margin-left":"-167px"}).css("display","block")},gradeHideHandler:function(){var t=$("#view-grade-box");t.hide()},vipBoxScroll:function(){var t=$("#vip-box"),i=t.children("ul"),n=t.find("li"),o=n.length*(i.width()+20),r=t.width(),l=$("#vip-arrow-right");o>r&&(l.css({display:"block"}),i.css({width:n.length*(n.width()+20)+"px"}),new a(t,{wrap:i,total:n.length,w3:n.width(),mw:e.setMw()}))},exchangeGift:function(t){var a=this;e.Ajax.getScript(a.url_config.EX_GIFT_URL+t.attr("data-id")+"&callback=UCENTER.exchangeGiftCallBack",null,!0)},exchangeGiftCallBack:function(t){var e=$("#load-box");if(!(e&&e.length>0)){var a=t.errno,i=$("#load-tpl").html();switch(a){case 0:var n=new Object;n.code=t.data.gift_cdkey,n.btnCon="\u524d\u5f80\u5151\u6362";var o=t.data.cdkey_endtime.split("-"),r=o[0]+"\u5e74"+o[1]+"\u6708"+o[2].substr(0,2)+"\u65e5\u524d";n.url=$("#"+t.data.gift_id).attr("data-url"),n.content="\u9886\u53d6\u6210\u529f\uff01\u8bf7\u524d\u5f80\u4f7f\u7528\uff0c\u6709\u6548\u671f\u4e3a"+r,$("#grade-wrap").find('a[data-id="'+t.data.gift_id+'"]').addClass("disabled").text("\u5df2\u9886\u53d6");break;default:var n=new Object;n.code="",n.btnCon="\u5173\u95ed",n.content=t.errmsg}var l=$(template.compile(i,n));$("body").append(l),$(".load-box").css("height",document.body.scrollHeight+"px")}},gradeGiftRender:function(t){if(0==t.errno){var e=t.data.game_gift_list,a=e.length,i=$("#grade-tpl").html(),n="",o=$("#grade-wrap");if(a>0){if(a>2){var r=e.slice(0,2),l=e.slice(2,4),s=new Object,c=new Object;s.list=r,c.list=l,n=template.compile(i,s)+template.compile(i,c),o.parent().next().css("display","block")}else{var d=new Object;d.list=e,n=template.compile(i,d)}o.html(n)}}},playRender:function(t){var a=this,i=function(e){if(e&&0==e.errno){var a=e.data,i=$("#play-log-tpl").html(),n="";if(0==a.length)return void t.hide();for(var o in a){var r=new Object;r.key=o,r.list=a[o],n+=template.compile(i,r)}t.append('<div class="left-b"></div>'+n).addClass("active")}else t.hide()};e.Ajax.getData(a.url_config.PLAY_LOG_URL,i,t)},taskRender:function(t){var i=UCENTER;if(0==t.errno){var n=t.data.user_task,o=$("#task-box"),r=n.length;if(n&&r>0){var l=$("#task-tpl").html(),s=new Object;s.list=n;var c=template.compile(l,s);o.html(c),o.css("width",e.swithWidthNew()*n.length+r+"px"),i.TASK_TAB&&(i.TASK_TAB.destroy(),i.TASK_TAB=null),n.length>2&&(i.TASK_TAB=new a($("#task-content"),{wrap:o,total:n.length,w3:e.swithWidthNew(),mw:2}))}}},mallRender:function(t){var i=UCENTER,n=t.errno;switch(n){case 0:var o=t.data.web;if(o&&o.length>0){var r=new Object,l=o.length;mallTpl=$("#mall-tpl").html(),taskContent=$("#task-content"),taskBox=$("#task-box");for(var s=0;s<l;s++)o[s].href=i.url_config.GOODS_DETAIL_URL+"&goods_applyid="+o[s].id+"&group="+o[s].group;r.list=o;var c=template.compile(mallTpl,r);taskBox.html(c),taskBox.css("width",e.swithWidthNew()*l+l+"px"),i.TASK_TAB&&(i.TASK_TAB.destroy(),i.TASK_TAB=null),o.length>2&&(i.TASK_TAB=new a(taskContent,{wrap:taskBox,total:o.length,w3:e.swithWidthNew(),mw:2}))}}},taskClickHandler:function(t){var a=this,i=t.attr("data-type");t.addClass("cur").siblings().removeClass("cur");var n=$("#more-goods-tpl").html();switch($("#task-box").html("<p style='text-align:center;width:1080px;margin-top:10px;'>\u52a0\u8f7d\u4e2d...</p>"),i){case"task":e.Ajax.getScript(a.url_config.TASK_URL+"?callback=UCENTER.taskRender",null,!0);var o=$("#task-tab").find("a.more-goods");o&&o.length>0&&o.remove();break;case"point":e.Ajax.getData(a.url_config.GET_MALL_URL,UCENTER.mallRender,$("#task-box")),$("#task-tab").append(n)}},getCvipPay:function(){var t=this;e.Ajax.getScript(t.url_config.CVIP_PAY_URL+"?callback=UCENTER.getCvipPaytCallBack",null,!0)},getCvipPaytCallBack:function(t){var e="";e+=0==t.errno&&t.data.count&&t.data.count>0?'<div class="zpd-info-box">\t<a href="./myzpd" target="_blank" class="zpd-icon" data-stat-role="ck">\t\t<img src="http://g4.ykimg.com/0C0100005846769F11476E001758A6F8">\t</a>\t<a href="./myzpd" target="_blank" class="zpd-text">\u6211\u7684\u5df2\u8d2d</a></div>':'<div class="zpd-info-box zpd-info-box-no">\t<a class="zpd-text" href="./myzpd" target="_blank">\u5f00\u901a\u9891\u9053\u4f1a\u5458</a></div>',$(".zpd-info-box").replaceWith(e),$(".zpd-info-box").show()},param:function(t){var e=[];return $.each(t,function(t,a){""!=a&&e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}),e.join("&")}},"function"==typeof define&&define.amd?define("UCENTER",["jQuery"],function(jQuery){new i}):t.UCENTER=new i}(window,jQuery);