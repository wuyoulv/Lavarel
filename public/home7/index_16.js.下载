/**
 * @modified $Author: 牟少峰 $
 * @version $Rev: c76fd6a27aa97a1fe737a49a4f293d0541c3bbac $
 */
!function(e,t,i){t.config({enable_ozma:true});t(["page/find/g","tui/view","tui/net","module/login/login"],function(t,i,n,a){t.init();var r=i.extend({el:e(".yk-content"),events:{"click .look-tv input":"lookAlbum","click .pack-close,.clear-all":"tipShow","click #delLayer .btn-cancel":"tipClose","click .need-login":"login","click #delLayer .btn-ok":"delRecord"},initialize:function(){var t=this;r.superClass.initialize.call(t);this.delLayer=this.find("#delLayer");t.delOp=null;t.delType=null;e(document).bind("click",function(i){if(e(i.target).closest(".del-layer").length)return false;else t.tipClose()});a.one("checklogin",function(){if(e(".no-record").length)if(a.uid())e(".login-txt").show();else e(".local-txt").show()})},lookAlbum:function(t){var i=this.find(".yk-pack:not(.pack-album)");if(e(t.currentTarget).is(":checked")){i.hide();if(e(".pack-album").length<1){e("#no-record").show();e(".local-txt").hide();e(".login-txt").show()}else e("#recordContent .his-list").each(function(){if(e(this).find(".pack-album").length<1)e(this).hide()})}else{e("#no-record").hide();i.closest(".his-list").show();i.show()}},login:function(){a.login(function(){window.location.reload()});return false},tipShow:function(t){var i=e(t.currentTarget);var n=i.offset();if(i.hasClass("clear-all")){this.delLayer.find("p").text("确定要删除所有记录吗?");n.left=n.left-99;this.delType="all";this.del={op:{_t:1*new Date}}}else{this.delLayer.find("p").text("确定要删除这条记录吗?");this.$pack=i.closest(".pack-rec");this.$pack.addClass("rec-hover");n.left=n.left-139;this.delType="single";var a=new Function("return"+unescape(i.attr("delinfo")))();this.del={el:i,op:{v:a.videoid,fid:a.folderid,shid:a.showid,_t:1*new Date}}}n.top=n.top+32;this.delLayer.show().css(n);return false},tipClose:function(e){this.$pack&&this.$pack.removeClass("rec-hover");this.delLayer.hide()},delRecord:function(){var t=this,i;this.delLayer.hide();if("all"==this.delType)i="//cmstool.youku.com/cms/playlog/clear.json?"+e.param(this.del.op);else{i="//cmstool.youku.com/cms/playlog/delete.json?"+e.param(this.del.op);var n=e(this.del.el).closest(".yk-row");e(this.del.el).closest(".pack-rec").remove();e("#recordSum").text(parseInt(e("#recordSum").text())-1);var a=0;if(e(".look-tv input").is(":checked"))a=n.find(".pack-album").length;else a=n.find(".pack-rec").length;if(0==a){var r=n.closest(".his-list");if(0==r.siblings(".his-list").length)if(e(".look-tv input").is(":checked")){r.remove();e("#no-record").show();e(".local-txt").hide();e(".login-txt").show()}else window.location.reload();else r.remove()}}var o=document.createElement("img");o.width=0;o.height=0;o.src=i;document.body.appendChild(o);setTimeout(function(){document.body.removeChild(o);if("all"==t.delType)window.location.reload()},500)}});new r})}(window.jQuery,window.oz.require,window.oz.define);;